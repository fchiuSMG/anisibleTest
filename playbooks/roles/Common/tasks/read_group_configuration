
- name: Get content of remote file
  ansible.builtin.slurp:
    src: ../groups/{{group_name}}.yml
  register: remote_file

- name: Interpret remote file content as yaml
  ansible.builtin.set_fact:
    group_configuration: '{{ remote_file.content | b64decode | from_yaml }}'

# - name: Print yaml for debugging purposes
#   ansible.builtin.debug:
#     var: group_configuration

- name: Test load variable 
  ansible.builtin.debug:
    msg: "key: {{ item.key }} ;; value {{ item.value }}"
  loop: "{{ group_configuration | dict2items }}"

- name: Load group_configuration into variables
  ansible.builtin.set_fact:
    "{{item.key}}_configuration": "{{item.value}}"
  loop: "{{ group_configuration | dict2items }}"

# - name: print test var 
#   ansible.builtin.debug:
#     msg: "Teamcity config : {{teamcity_configuration}}"